name: ğŸ”„ Sync App from Dev

on:
  workflow_dispatch:  # Manueller Start

jobs:
  sync-app:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Haupt-Repo auschecken
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: âš™ï¸ Git konfigurieren
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: ğŸ“¥ Dev-Repo in temp-Ordner clonen
        run: |
          echo "ğŸ“¦ Clone Dev-Repo..."
          git clone --depth 1 https://github.com/pjolo/app_develop.git temp-dev
          echo "âœ… Clone erfolgreich"
      
      - name: ğŸ—‘ï¸ Alten app/ Inhalt lÃ¶schen
        run: |
          echo "ğŸ—‘ï¸ LÃ¶sche alte Dateien in app/..."
          rm -rf app/*
          echo "âœ… app/ Ordner geleert"
      
      - name: ğŸ“‹ Neue Dateien nach app/ kopieren
        run: |
          echo "ğŸ“‹ Kopiere Dateien..."
          mkdir -p app
          cp -r temp-dev/* app/
          # README nicht kopieren
          rm -f app/README.md
          echo "âœ… Dateien kopiert"
          echo "ğŸ“‚ Inhalt von app/:"
          ls -la app/
      
      - name: ğŸ§¹ temp-dev Ordner aufrÃ¤umen
        run: |
          rm -rf temp-dev
          echo "âœ… AufgerÃ¤umt"
      
      - name: ğŸ“ Ã„nderungen committen
        run: |
          git add app/
          if git diff --staged --quiet; then
            echo "â„¹ï¸ Keine Ã„nderungen zum Committen"
          else
            git commit -m "ğŸš€ Update app from dev repo [$(date +'%Y-%m-%d %H:%M')]"
            echo "âœ… Commit erstellt"
          fi
      
      - name: ğŸ“¤ Zu main pushen
        run: |
          git push origin main
          echo "âœ… Push erfolgreich!"
          echo "ğŸŒ Deine App ist live auf: https://pjolo/FHIR-Showcase/app/"

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Insel der Zeit - Point & Click Adventure</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cormorant Garamond', serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><circle cx="12" cy="12" r="8" fill="rgba(255,255,255,0.3)" stroke="white" stroke-width="2"/></svg>') 12 12, auto;
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        #scene {
            width: 100%;
            height: 100%;
            position: relative;
            transition: opacity 1.5s ease-in-out;
            background-size: cover;
            background-position: center;
        }

        .scene-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.4) 100%);
            pointer-events: none;
        }

        /* Animated particles */
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: float 6s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(20px); opacity: 0; }
        }

        /* Hotspots with beautiful hover effects */
        .hotspot {
            position: absolute;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border-radius: 10px;
        }

        .hotspot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, rgba(255,215,0,0.6) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            transition: all 0.4s;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }

        .hotspot:hover::before {
            opacity: 1;
            animation: none;
            width: 50px;
            height: 50px;
        }

        .hotspot:hover {
            filter: brightness(1.3);
            transform: scale(1.05);
        }

        /* Navigation arrows */
        .nav-arrow {
            position: absolute;
            bottom: 50px;
            width: 80px;
            height: 80px;
            background: rgba(0, 0, 0, 0.6);
            border: 3px solid rgba(255, 215, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.4s;
            backdrop-filter: blur(10px);
        }

        .nav-arrow:hover {
            background: rgba(139, 105, 20, 0.8);
            border-color: gold;
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }

        .nav-arrow.left { left: 50px; }
        .nav-arrow.right { right: 50px; }
        .nav-arrow.forward { 
            left: 50%; 
            transform: translateX(-50%);
            bottom: 30px;
        }
        .nav-arrow.back { 
            left: 50%; 
            transform: translateX(-50%);
            bottom: 30px;
        }

        /* UI Elements */
        #ui-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        #game-title {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            color: gold;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            letter-spacing: 3px;
        }

        #inventory {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .inventory-slot {
            width: 60px;
            height: 60px;
            background: rgba(20, 20, 20, 0.8);
            border: 2px solid rgba(139, 105, 20, 0.6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            backdrop-filter: blur(5px);
        }

        .inventory-slot:hover {
            border-color: gold;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            transform: translateY(-5px);
        }

        .inventory-slot.has-item {
            background: rgba(139, 105, 20, 0.3);
            border-color: gold;
        }

        .inventory-slot::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .inventory-slot:hover::after {
            opacity: 1;
        }

        #action-buttons {
            display: flex;
            gap: 15px;
        }

        .ui-button {
            padding: 12px 25px;
            background: rgba(139, 105, 20, 0.6);
            border: 2px solid rgba(255, 215, 0, 0.4);
            color: white;
            font-family: 'Cinzel', serif;
            font-size: 14px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            letter-spacing: 1px;
        }

        .ui-button:hover {
            background: rgba(139, 105, 20, 0.9);
            border-color: gold;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        /* Message Box with beautiful styling */
        #message-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #message-box {
            max-width: 700px;
            background: linear-gradient(135deg, rgba(20, 20, 30, 0.95) 0%, rgba(40, 30, 20, 0.95) 100%);
            border: 3px solid gold;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.3);
            position: relative;
            animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        #message-box::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, gold, #ff6b6b, #4ecdc4, gold);
            border-radius: 20px;
            z-index: -1;
            opacity: 0.3;
            animation: rotate 3s linear infinite;
        }

        @keyframes rotate {
            100% { filter: hue-rotate(360deg); }
        }

        #message-title {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            color: gold;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        #message-text {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 30px;
            text-align: center;
            color: #e0e0e0;
        }

        #message-button {
            display: block;
            margin: 0 auto;
            padding: 15px 40px;
            background: linear-gradient(135deg, #8b6914 0%, #daa520 100%);
            border: none;
            color: white;
            font-family: 'Cinzel', serif;
            font-size: 16px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        #message-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        /* Journal/Notes */
        #journal {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(30, 20, 10, 0.98) 0%, rgba(50, 35, 20, 0.98) 100%);
            border-left: 3px solid gold;
            padding: 30px;
            z-index: 200;
            transition: right 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            box-shadow: -5px 0 30px rgba(0, 0, 0, 0.5);
        }

        #journal.open {
            right: 0;
        }

        #journal h2 {
            font-family: 'Cinzel', serif;
            color: gold;
            font-size: 32px;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .journal-entry {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid rgba(255, 215, 0, 0.5);
            border-radius: 8px;
            animation: slideInRight 0.5s;
        }

        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .journal-entry-title {
            font-family: 'Cinzel', serif;
            color: gold;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .journal-entry-text {
            font-size: 14px;
            line-height: 1.6;
            color: #d0d0d0;
        }

        /* Puzzle Overlay */
        #puzzle-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .puzzle-container {
            background: linear-gradient(135deg, rgba(20, 20, 40, 0.95) 0%, rgba(40, 30, 50, 0.95) 100%);
            padding: 50px;
            border-radius: 20px;
            border: 3px solid gold;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.4);
        }

        .puzzle-title {
            font-family: 'Cinzel', serif;
            font-size: 36px;
            color: gold;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        /* Mechanical Puzzle */
        .gear-puzzle {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .gear {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #8b7355 0%, #5c4a3a 100%);
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            border: 5px solid #3a2f23;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5), 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .gear:hover {
            transform: scale(1.05);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5), 0 5px 30px rgba(255, 215, 0, 0.3);
        }

        .gear::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: #2a1f1a;
            border-radius: 50%;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .gear-tooth {
            position: absolute;
            width: 20px;
            height: 40px;
            background: linear-gradient(135deg, #8b7355 0%, #5c4a3a 100%);
            left: 50%;
            transform-origin: center;
        }

        .gear.rotating {
            animation: rotateGear 2s linear infinite;
        }

        @keyframes rotateGear {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Crystal Puzzle */
        .crystal-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 500px;
            margin: 40px auto;
        }

        .crystal {
            width: 120px;
            height: 140px;
            background: linear-gradient(135deg, rgba(100, 200, 255, 0.3) 0%, rgba(0, 100, 200, 0.5) 100%);
            clip-path: polygon(50% 0%, 100% 30%, 100% 70%, 50% 100%, 0% 70%, 0% 30%);
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 100, 200, 0.3);
        }

        .crystal:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 50px rgba(100, 200, 255, 0.5);
        }

        .crystal.active {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.6) 0%, rgba(255, 165, 0, 0.8) 100%);
            animation: crystalGlow 1s ease-in-out infinite;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.6);
        }

        @keyframes crystalGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.5); }
        }

        /* Symbol Constellation Puzzle */
        .constellation-canvas {
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, #001a33 0%, #000 70%);
            border-radius: 15px;
            position: relative;
            margin: 30px auto;
            box-shadow: inset 0 0 50px rgba(0, 50, 100, 0.5), 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 4px white;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .constellation-star {
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, gold 0%, rgba(255, 215, 0, 0.5) 100%);
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }

        .constellation-star:hover {
            transform: scale(1.5);
            box-shadow: 0 0 20px gold;
        }

        .constellation-star.selected {
            background: radial-gradient(circle, lime 0%, rgba(0, 255, 0, 0.5) 100%);
            box-shadow: 0 0 30px lime;
            animation: selectedPulse 0.5s;
        }

        @keyframes selectedPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1.2); }
        }

        .constellation-line {
            position: absolute;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, gold 50%, transparent 100%);
            transform-origin: left center;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .constellation-line.visible {
            opacity: 1;
        }

        /* Puzzle buttons */
        .puzzle-button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #8b6914 0%, #daa520 100%);
            border: 2px solid gold;
            color: white;
            font-family: 'Cinzel', serif;
            font-size: 16px;
            cursor: pointer;
            border-radius: 10px;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .puzzle-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .puzzle-button.secondary {
            background: linear-gradient(135deg, #555 0%, #777 100%);
        }

        /* Sound wave effect */
        @keyframes soundWave {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .sound-wave {
            position: absolute;
            width: 100px;
            height: 100px;
            border: 3px solid gold;
            border-radius: 50%;
            animation: soundWave 2s ease-out;
        }

        /* Loading screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 1s;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-title {
            font-family: 'Cinzel', serif;
            font-size: 48px;
            color: gold;
            margin-bottom: 40px;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            animation: fadeInOut 2s ease-in-out infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .loading-bar {
            width: 400px;
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            border: 2px solid gold;
        }

        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, gold 0%, #ff6b6b 50%, #4ecdc4 100%);
            transition: width 0.3s;
            box-shadow: 0 0 20px gold;
        }

        /* Ambient sounds indicator */
        #sound-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid gold;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        #sound-indicator:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        #sound-indicator.muted {
            opacity: 0.5;
        }

        /* Responsive */
        @media (max-width: 768px) {
            #game-title { font-size: 20px; }
            #ui-panel { padding: 0 20px; height: 60px; }
            .nav-arrow { width: 60px; height: 60px; font-size: 24px; }
            #journal { width: 100%; }
            .puzzle-container { padding: 30px; }
            .constellation-canvas { width: 100%; height: 400px; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-title">DIE INSEL DER ZEIT</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loading-progress"></div>
        </div>
        <p style="margin-top: 20px; font-family: 'Cormorant Garamond', serif; color: #999;">Lade Geheimnisse...</p>
    </div>

    <!-- Main Game Container -->
    <div id="game-container">
        <!-- UI Panel -->
        <div id="ui-panel">
            <div id="game-title">DIE INSEL DER ZEIT</div>
            
            <div id="inventory">
                <div class="inventory-slot" data-tooltip="Leer"></div>
                <div class="inventory-slot" data-tooltip="Leer"></div>
                <div class="inventory-slot" data-tooltip="Leer"></div>
                <div class="inventory-slot" data-tooltip="Leer"></div>
            </div>

            <div id="action-buttons">
                <button class="ui-button" onclick="toggleJournal()">üìñ Tagebuch</button>
                <button class="ui-button" onclick="showHelp()">‚ùì Hilfe</button>
            </div>
        </div>

        <!-- Main Scene -->
        <div id="scene">
            <div class="scene-overlay"></div>
        </div>

        <!-- Sound Indicator -->
        <div id="sound-indicator" onclick="toggleSound()">üîä</div>

        <!-- Journal Panel -->
        <div id="journal">
            <h2>‚öúÔ∏è Tagebuch ‚öúÔ∏è</h2>
            <div id="journal-entries"></div>
        </div>
    </div>

    <!-- Message Overlay -->
    <div id="message-overlay">
        <div id="message-box">
            <div id="message-title"></div>
            <div id="message-text"></div>
            <button id="message-button">Weiter</button>
        </div>
    </div>

    <!-- Puzzle Overlay -->
    <div id="puzzle-overlay">
        <div class="puzzle-container" id="puzzle-container">
            <!-- Puzzle content will be inserted here -->
        </div>
    </div>

    <script>
        // ===== GAME STATE =====
        const gameState = {
            currentScene: 'beach',
            inventory: [],
            journal: [],
            soundEnabled: true,
            puzzlesSolved: {
                gears: false,
                crystals: false,
                constellation: false,
                finalDoor: false
            },
            gearRotations: [0, 0, 0],
            crystalPattern: [],
            constellationStars: [],
            correctCrystalPattern: [0, 2, 4, 6, 8],
            correctConstellation: ['star-2', 'star-5', 'star-8']
        };

        // ===== SCENE DEFINITIONS =====
        const scenes = {
            beach: {
                name: 'Strand der Ankunft',
                background: 'linear-gradient(to bottom, #87CEEB 0%, #E0F6FF 50%, #F4E4C1 100%)',
                description: 'Du erwachst am Strand einer geheimnisvollen Insel. Kristallklares Wasser leckt an deinen F√º√üen. Vor dir erhebt sich ein dichter, mystischer Wald.',
                hotspots: [
                    { 
                        id: 'shell', 
                        left: '20%', 
                        top: '70%', 
                        width: '80px', 
                        height: '80px',
                        content: 'üêö',
                        action: 'examineShell'
                    },
                    {
                        id: 'bottle',
                        left: '70%',
                        top: '65%',
                        width: '60px',
                        height: '80px',
                        content: 'üçæ',
                        action: 'examineBottle'
                    }
                ],
                navigation: [
                    { direction: 'forward', target: 'forest', icon: '‚¨ÜÔ∏è' }
                ]
            },
            forest: {
                name: 'Uralter Wald',
                background: 'linear-gradient(to bottom, #1a3a1a 0%, #2d5a2d 50%, #4a7c4a 100%)',
                description: 'Gigantische B√§ume ragen in den Himmel. Seltsame Runen leuchten schwach auf ihrer Rinde. Ein schmaler Pfad f√ºhrt tiefer hinein.',
                hotspots: [
                    {
                        id: 'rune-tree',
                        left: '40%',
                        top: '30%',
                        width: '100px',
                        height: '200px',
                        content: 'üå≥',
                        action: 'examineRunes'
                    },
                    {
                        id: 'mushrooms',
                        left: '65%',
                        top: '60%',
                        width: '80px',
                        height: '60px',
                        content: 'üçÑ',
                        action: 'examineMushrooms'
                    }
                ],
                navigation: [
                    { direction: 'back', target: 'beach', icon: '‚¨áÔ∏è' },
                    { direction: 'forward', target: 'clearing', icon: '‚¨ÜÔ∏è' }
                ]
            },
            clearing: {
                name: 'Lichtung der Mechanik',
                background: 'linear-gradient(135deg, #3a6186 0%, #89253e 100%)',
                description: 'Eine kreisrunde Lichtung √∂ffnet sich vor dir. In der Mitte steht eine uralte mechanische Konstruktion mit drei gro√üen Zahnr√§dern.',
                hotspots: [
                    {
                        id: 'gear-machine',
                        left: '35%',
                        top: '35%',
                        width: '200px',
                        height: '200px',
                        content: '‚öôÔ∏è',
                        action: 'activateGearPuzzle'
                    },
                    {
                        id: 'stone-tablet',
                        left: '70%',
                        top: '60%',
                        width: '80px',
                        height: '100px',
                        content: 'üìú',
                        action: 'examineTablet'
                    }
                ],
                navigation: [
                    { direction: 'back', target: 'forest', icon: '‚¨áÔ∏è' },
                    { direction: 'forward', target: 'temple', icon: '‚¨ÜÔ∏è', locked: true, unlockCondition: 'gears' }
                ]
            },
            temple: {
                name: 'Kristalltempel',
                background: 'radial-gradient(ellipse at center, #667eea 0%, #764ba2 100%)',
                description: 'Ein pr√§chtiger Tempel aus schimmernden Kristallen. Neun Kristalle sind in einem magischen Muster angeordnet.',
                hotspots: [
                    {
                        id: 'crystal-altar',
                        left: '40%',
                        top: '40%',
                        width: '150px',
                        height: '150px',
                        content: 'üíé',
                        action: 'activateCrystalPuzzle'
                    },
                    {
                        id: 'ancient-book',
                        left: '15%',
                        top: '65%',
                        width: '70px',
                        height: '70px',
                        content: 'üìñ',
                        action: 'examineAncientBook'
                    }
                ],
                navigation: [
                    { direction: 'back', target: 'clearing', icon: '‚¨áÔ∏è' },
                    { direction: 'forward', target: 'observatory', icon: '‚¨ÜÔ∏è', locked: true, unlockCondition: 'crystals' }
                ]
            },
            observatory: {
                name: 'Sternenobservatorium',
                background: 'radial-gradient(circle, #0f2027 0%, #203a43 50%, #2c5364 100%)',
                description: 'Die Kuppel eines uralten Observatoriums. Ein riesiges Teleskop zeigt auf den Nachthimmel voller Sterne.',
                hotspots: [
                    {
                        id: 'telescope',
                        left: '40%',
                        top: '30%',
                        width: '150px',
                        height: '250px',
                        content: 'üî≠',
                        action: 'activateConstellationPuzzle'
                    },
                    {
                        id: 'star-map',
                        left: '70%',
                        top: '50%',
                        width: '90px',
                        height: '90px',
                        content: 'üó∫Ô∏è',
                        action: 'examineStarMap'
                    }
                ],
                navigation: [
                    { direction: 'back', target: 'temple', icon: '‚¨áÔ∏è' },
                    { direction: 'forward', target: 'sanctum', icon: '‚¨ÜÔ∏è', locked: true, unlockCondition: 'constellation' }
                ]
            },
            sanctum: {
                name: 'Sanctum der Zeit',
                background: 'radial-gradient(circle, #f7971e 0%, #ffd200 50%, #f7971e 100%)',
                description: '‚ú® Du hast es geschafft! Das innere Heiligtum erstrahlt in goldenem Licht. Eine schwebende Sanduhr schwebt in der Mitte - der Zeitsplitter!',
                hotspots: [
                    {
                        id: 'time-shard',
                        left: '42%',
                        top: '35%',
                        width: '120px',
                        height: '180px',
                        content: '‚åõ',
                        action: 'examineTimeShard'
                    }
                ],
                navigation: []
            }
        };

        // ===== INITIALIZATION =====
        function initGame() {
            simulateLoading();
        }

        function simulateLoading() {
            const progress = document.getElementById('loading-progress');
            let width = 0;
            const interval = setInterval(() => {
                width += 10;
                progress.style.width = width + '%';
                if (width >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('loading-screen').classList.add('hidden');
                        showIntroMessage();
                    }, 500);
                }
            }, 200);
        }

        function showIntroMessage() {
            showMessage(
                '‚öúÔ∏è Willkommen ‚öúÔ∏è',
                'Du erwachst an einem unbekannten Strand. Die Wellen haben dich hier angeschwemmt.\n\nVor dir liegt eine mysteri√∂se Insel voller Geheimnisse und uralter Magie.\n\nIrgendwo hier verbirgt sich der legend√§re Zeitsplitter - ein Artefakt von unvorstellbarer Macht.\n\nErforsche die Insel, l√∂se ihre R√§tsel und enth√ºlle ihr gr√∂√ütes Geheimnis...',
                () => {
                    loadScene('beach');
                    addJournalEntry('Ankunft', 'Ich bin auf einer mysteri√∂sen Insel gestrandet. Mein Ziel: Den Zeitsplitter finden.');
                }
            );
        }

        // ===== SCENE MANAGEMENT =====
        function loadScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) return;

            gameState.currentScene = sceneId;
            const sceneEl = document.getElementById('scene');
            
            // Fade out
            sceneEl.style.opacity = '0';
            
            setTimeout(() => {
                sceneEl.innerHTML = '<div class="scene-overlay"></div>';
                sceneEl.style.background = scene.background;
                
                // Add particles
                createParticles(sceneEl);
                
                // Add scene title
                const title = document.createElement('div');
                title.style.cssText = `
                    position: absolute;
                    top: 100px;
                    left: 50%;
                    transform: translateX(-50%);
                    font-family: 'Cinzel', serif;
                    font-size: 42px;
                    color: gold;
                    text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 60px rgba(255, 215, 0, 0.4);
                    text-align: center;
                    animation: fadeIn 2s;
                    z-index: 10;
                `;
                title.textContent = scene.name;
                sceneEl.appendChild(title);

                // Add description
                const desc = document.createElement('div');
                desc.style.cssText = `
                    position: absolute;
                    top: 160px;
                    left: 50%;
                    transform: translateX(-50%);
                    width: 70%;
                    max-width: 800px;
                    font-size: 20px;
                    text-align: center;
                    color: rgba(255, 255, 255, 0.9);
                    background: rgba(0, 0, 0, 0.6);
                    padding: 20px 30px;
                    border-radius: 15px;
                    backdrop-filter: blur(10px);
                    border: 2px solid rgba(255, 215, 0, 0.3);
                    animation: slideIn 1s;
                    z-index: 10;
                `;
                desc.textContent = scene.description;
                sceneEl.appendChild(desc);

                // Add hotspots
                scene.hotspots.forEach((hotspot, index) => {
                    setTimeout(() => {
                        createHotspot(sceneEl, hotspot);
                    }, index * 200);
                });

                // Add navigation
                scene.navigation.forEach(nav => {
                    createNavArrow(sceneEl, nav);
                });

                // Fade in
                sceneEl.style.opacity = '1';
            }, 1000);
        }

        function createParticles(container) {
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = (Math.random() * 3 + 1) + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                container.appendChild(particle);
            }
        }

        function createHotspot(container, hotspot) {
            const el = document.createElement('div');
            el.className = 'hotspot';
            el.style.left = hotspot.left;
            el.style.top = hotspot.top;
            el.style.width = hotspot.width;
            el.style.height = hotspot.height;
            el.style.fontSize = '48px';
            el.style.display = 'flex';
            el.style.alignItems = 'center';
            el.style.justifyContent = 'center';
            el.textContent = hotspot.content;
            el.onclick = () => handleAction(hotspot.action);
            el.style.animation = 'fadeIn 1s';
            container.appendChild(el);
        }

        function createNavArrow(container, nav) {
            if (nav.locked && !gameState.puzzlesSolved[nav.unlockCondition]) {
                return; // Don't show locked paths
            }

            const arrow = document.createElement('div');
            arrow.className = `nav-arrow ${nav.direction}`;
            arrow.textContent = nav.icon;
            arrow.onclick = () => loadScene(nav.target);
            container.appendChild(arrow);
        }

        // ===== ACTION HANDLERS =====
        function handleAction(action) {
            const actions = {
                examineShell: () => {
                    showMessage('üêö Meeresmuschel', 'Eine wundersch√∂ne Muschel. Du h√∂rst das Rauschen des Meeres, wenn du sie ans Ohr h√§ltst.');
                    if (!gameState.inventory.includes('üêö')) {
                        addToInventory('üêö', 'Meeresmuschel');
                        addJournalEntry('Muschel gefunden', 'Eine sch√∂ne Muschel vom Strand. Vielleicht n√ºtzlich?');
                    }
                },
                examineBottle: () => {
                    showMessage('üçæ Flaschenpost', 'Eine alte Flasche mit einer Nachricht darin:\n\n"Drei mal drei im Kristallschein,\nmuss das Muster richtig sein.\nEckpunkte sind der Schl√ºssel hier,\nzum √ñffnen dieser T√ºr zu dir."');
                    addJournalEntry('Flaschenpost', 'Hinweis auf Kristallmuster: 3x3, Eckpunkte wichtig');
                },
                examineRunes: () => {
                    showMessage('üå≥ Runenb√§ume', 'Uralte Runen bedecken die Baumrinde. Sie scheinen eine Geschichte zu erz√§hlen:\n\n"Die Zahnr√§der der Zeit drehen sich im Einklang.\nLinks dreht rechts, rechts dreht links.\nDas mittlere verbindet beide Welten."');
                    addJournalEntry('Runen der B√§ume', 'Zahnr√§der-Hinweis: Links-Rechts-Verbindung beachten');
                },
                examineMushrooms: () => {
                    showMessage('üçÑ Leuchtpilze', 'Biolumineszente Pilze erhellen den Waldboden. Sie pulsieren in einem hypnotischen Rhythmus.');
                },
                examineTablet: () => {
                    showMessage('üìú Steintafel', 'Eine Inschrift auf der Tafel:\n\n"Wenn die Zahnr√§der sich im Gleichklang drehen,\nwird der Weg sich √∂ffnen und bestehen.\nDrei Umdrehungen f√ºr jeden Zahn,\nzeigt dir den weiteren Pfad hinan."');
                    addJournalEntry('Steintafel', 'Zahnr√§der m√ºssen 3 Umdrehungen machen - alle gleichzeitig!');
                },
                examineAncientBook: () => {
                    showMessage('üìñ Altes Buch', 'Ein verstaubtes Buch mit Diagrammen:\n\n[Skizze zeigt 3x3 Gitter]\n"Die f√ºnf Ecken und das Zentrum formen das Portal.\nAktiviere sie in der Reihenfolge: Oben links, oben rechts, Mitte, unten links, unten rechts."');
                    addJournalEntry('Kristallbuch', 'Kristallmuster: 5 Positionen - Ecken + Zentrum');
                },
                examineStarMap: () => {
                    showMessage('üó∫Ô∏è Sternenkarte', 'Eine alte Karte des Nachthimmels. Drei Sterne sind mit goldenen Linien markiert - sie bilden ein perfektes Dreieck.\n\n"Das Dreieck der Zeit zeigt den Weg."');
                    addJournalEntry('Sternenkarte', 'Drei Sterne bilden Dreieck - das ist das Muster!');
                },
                examineTimeShard: () => {
                    showMessage(
                        '‚åõ DER ZEITSPLITTER ‚åõ',
                        '‚ú® HERZLICHEN GL√úCKWUNSCH! ‚ú®\n\nDu hast den legend√§ren Zeitsplitter gefunden!\n\nDieses uralte Artefakt besitzt die Macht, den Lauf der Zeit zu beeinflussen. Die Insel hat dich f√ºr w√ºrdig befunden, ihr gr√∂√ütes Geheimnis zu kennen.\n\nDu hast alle R√§tsel gel√∂st und die verborgene Weisheit der Insel entdeckt.\n\nüèÜ SPIEL ERFOLGREICH ABGESCHLOSSEN üèÜ\n\nDanke f√ºrs Spielen!',
                        null
                    );
                    addToInventory('‚åõ', 'Zeitsplitter');
                    addJournalEntry('SIEG!', 'Ich habe den Zeitsplitter gefunden! Die Reise ist vollendet.');
                },
                activateGearPuzzle: () => {
                    if (gameState.puzzlesSolved.gears) {
                        showMessage('‚öôÔ∏è Zahnr√§der', 'Die Mechanik arbeitet perfekt. Der Weg ist frei.');
                    } else {
                        showGearPuzzle();
                    }
                },
                activateCrystalPuzzle: () => {
                    if (gameState.puzzlesSolved.crystals) {
                        showMessage('üíé Kristalle', 'Die Kristalle leuchten in perfekter Harmonie.');
                    } else {
                        showCrystalPuzzle();
                    }
                },
                activateConstellationPuzzle: () => {
                    if (gameState.puzzlesSolved.constellation) {
                        showMessage('üî≠ Sterne', 'Das Dreieck der Zeit erstrahlt am Himmel.');
                    } else {
                        showConstellationPuzzle();
                    }
                }
            };

            if (actions[action]) {
                playSound('click');
                actions[action]();
            }
        }

        // ===== GEAR PUZZLE =====
        function showGearPuzzle() {
            const overlay = document.getElementById('puzzle-overlay');
            const container = document.getElementById('puzzle-container');
            
            container.innerHTML = `
                <div class="puzzle-title">‚öôÔ∏è Mechanisches R√§tsel ‚öôÔ∏è</div>
                <p style="text-align: center; font-size: 18px; margin-bottom: 30px; color: #ddd;">
                    Drehe die Zahnr√§der so, dass alle drei gleichzeitig rotieren!<br>
                    <small>Hinweis: Jedes Zahnrad beeinflusst seine Nachbarn</small>
                </p>
                <div class="gear-puzzle" id="gear-container"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="puzzle-button" onclick="checkGears()">Pr√ºfen</button>
                    <button class="puzzle-button secondary" onclick="resetGears()">Zur√ºcksetzen</button>
                    <button class="puzzle-button secondary" onclick="closePuzzle()">Schlie√üen</button>
                </div>
            `;

            const gearContainer = document.getElementById('gear-container');
            for (let i = 0; i < 3; i++) {
                const gear = document.createElement('div');
                gear.className = 'gear';
                gear.id = `gear-${i}`;
                gear.onclick = () => rotateGear(i);
                
                // Add gear teeth
                for (let j = 0; j < 8; j++) {
                    const tooth = document.createElement('div');
                    tooth.className = 'gear-tooth';
                    tooth.style.transform = `translateX(-50%) rotate(${j * 45}deg) translateY(-50px)`;
                    gear.appendChild(tooth);
                }
                
                gearContainer.appendChild(gear);
            }

            overlay.style.display = 'flex';
        }

        function rotateGear(index) {
            playSound('gear');
            gameState.gearRotations[index]++;
            
            // Each gear affects its neighbors
            if (index === 0) gameState.gearRotations[1]++;
            if (index === 1) {
                gameState.gearRotations[0]++;
                gameState.gearRotations[2]++;
            }
            if (index === 2) gameState.gearRotations[1]++;

            updateGearDisplay();
        }

        function updateGearDisplay() {
            gameState.gearRotations.forEach((rotation, index) => {
                const gear = document.getElementById(`gear-${index}`);
                if (gear) {
                    gear.style.transform = `rotate(${rotation * 45}deg)`;
                }
            });
        }

        function resetGears() {
            gameState.gearRotations = [0, 0, 0];
            updateGearDisplay();
        }

        function checkGears() {
            // Check if all gears have exactly 3 full rotations (24 clicks = 3 * 360/45)
            const allCorrect = gameState.gearRotations.every(r => r % 8 === 0 && r >= 24);
            
            if (allCorrect) {
                gameState.puzzlesSolved.gears = true;
                playSound('success');
                closePuzzle();
                showMessage(
                    '‚úÖ Zahnr√§der gel√∂st!',
                    'Die Mechanik erwacht zum Leben! Die Zahnr√§der drehen sich in perfekter Harmonie.\n\nEin lautes Klicken ert√∂nt - der Weg nach vorne ist nun frei!',
                    () => {
                        loadScene('clearing');
                        addJournalEntry('Zahnrad-Mechanik', 'Ich habe die Mechanik aktiviert. Der Weg zum Tempel ist offen!');
                    }
                );
            } else {
                showMessage('‚ùå Nicht ganz...', 'Die Zahnr√§der sind noch nicht im richtigen Rhythmus. Versuche es erneut!');
            }
        }

        // ===== CRYSTAL PUZZLE =====
        function showCrystalPuzzle() {
            const overlay = document.getElementById('puzzle-overlay');
            const container = document.getElementById('puzzle-container');
            
            container.innerHTML = `
                <div class="puzzle-title">üíé Kristall-R√§tsel üíé</div>
                <p style="text-align: center; font-size: 18px; margin-bottom: 30px; color: #ddd;">
                    Aktiviere die richtigen Kristalle, um das Portal zu √∂ffnen!<br>
                    <small>Hinweis: Die Ecken und die Mitte sind der Schl√ºssel</small>
                </p>
                <div class="crystal-grid" id="crystal-grid"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <div id="crystal-status" style="margin-bottom: 15px; font-size: 16px;">Aktiviert: 0/5</div>
                    <button class="puzzle-button" onclick="checkCrystals()">Pr√ºfen</button>
                    <button class="puzzle-button secondary" onclick="resetCrystals()">Zur√ºcksetzen</button>
                    <button class="puzzle-button secondary" onclick="closePuzzle()">Schlie√üen</button>
                </div>
            `;

            const grid = document.getElementById('crystal-grid');
            for (let i = 0; i < 9; i++) {
                const crystal = document.createElement('div');
                crystal.className = 'crystal';
                crystal.id = `crystal-${i}`;
                crystal.onclick = () => toggleCrystal(i);
                grid.appendChild(crystal);
            }

            overlay.style.display = 'flex';
        }

        function toggleCrystal(index) {
            playSound('crystal');
            const crystal = document.getElementById(`crystal-${index}`);
            
            if (gameState.crystalPattern.includes(index)) {
                gameState.crystalPattern = gameState.crystalPattern.filter(i => i !== index);
                crystal.classList.remove('active');
            } else if (gameState.crystalPattern.length < 5) {
                gameState.crystalPattern.push(index);
                crystal.classList.add('active');
            }

            document.getElementById('crystal-status').textContent = `Aktiviert: ${gameState.crystalPattern.length}/5`;
        }

        function resetCrystals() {
            gameState.crystalPattern = [];
            for (let i = 0; i < 9; i++) {
                const crystal = document.getElementById(`crystal-${i}`);
                if (crystal) crystal.classList.remove('active');
            }
            document.getElementById('crystal-status').textContent = 'Aktiviert: 0/5';
        }

        function checkCrystals() {
            // Correct pattern: corners and center (0, 2, 4, 6, 8)
            const sorted = [...gameState.crystalPattern].sort((a, b) => a - b);
            const correct = JSON.stringify(sorted) === JSON.stringify(gameState.correctCrystalPattern);
            
            if (correct) {
                gameState.puzzlesSolved.crystals = true;
                playSound('success');
                closePuzzle();
                showMessage(
                    '‚úÖ Kristalle gel√∂st!',
                    'Die Kristalle beginnen in einem harmonischen Licht zu pulsieren!\n\nEine Welle magischer Energie erf√ºllt den Tempel. Eine verborgene T√ºr √∂ffnet sich und gibt den Weg zum Observatorium frei!',
                    () => {
                        loadScene('temple');
                        addJournalEntry('Kristall-Portal', 'Das Kristallmuster war richtig! Der Weg zu den Sternen ist offen.');
                    }
                );
            } else {
                showMessage('‚ùå Falsche Kombination', 'Diese Kristalle formen nicht das richtige Muster. Denke an die Ecken...');
            }
        }

        // ===== CONSTELLATION PUZZLE =====
        function showConstellationPuzzle() {
            const overlay = document.getElementById('puzzle-overlay');
            const container = document.getElementById('puzzle-container');
            
            container.innerHTML = `
                <div class="puzzle-title">üî≠ Sternbild-R√§tsel üî≠</div>
                <p style="text-align: center; font-size: 18px; margin-bottom: 20px; color: #ddd;">
                    Finde die drei Sterne, die das Dreieck der Zeit bilden!<br>
                    <small>Hinweis: Sie formen ein perfektes gleichseitiges Dreieck</small>
                </p>
                <div class="constellation-canvas" id="star-canvas"></div>
                <div style="text-align: center; margin-top: 20px;">
                    <div id="constellation-status" style="margin-bottom: 15px; font-size: 16px;">Ausgew√§hlt: 0/3</div>
                    <button class="puzzle-button" onclick="checkConstellation()">Pr√ºfen</button>
                    <button class="puzzle-button secondary" onclick="resetConstellation()">Zur√ºcksetzen</button>
                    <button class="puzzle-button secondary" onclick="closePuzzle()">Schlie√üen</button>
                </div>
            `;

            const canvas = document.getElementById('star-canvas');
            
            // Add random background stars
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                canvas.appendChild(star);
            }

            // Add constellation stars (forming triangle)
            const constellationPositions = [
                { id: 'star-0', left: '20%', top: '30%' },
                { id: 'star-1', left: '40%', top: '50%' },
                { id: 'star-2', left: '30%', top: '20%' }, // Top of triangle
                { id: 'star-3', left: '60%', top: '40%' },
                { id: 'star-4', left: '80%', top: '60%' },
                { id: 'star-5', left: '70%', top: '20%' }, // Top right of triangle
                { id: 'star-6', left: '45%', top: '70%' },
                { id: 'star-7', left: '25%', top: '65%' },
                { id: 'star-8', left: '50%', top: '65%' }  // Bottom of triangle
            ];

            constellationPositions.forEach(pos => {
                const star = document.createElement('div');
                star.className = 'star constellation-star';
                star.id = pos.id;
                star.style.left = pos.left;
                star.style.top = pos.top;
                star.onclick = () => selectConstellationStar(pos.id);
                canvas.appendChild(star);
            });

            overlay.style.display = 'flex';
        }

        function selectConstellationStar(starId) {
            playSound('star');
            const star = document.getElementById(starId);
            
            if (gameState.constellationStars.includes(starId)) {
                gameState.constellationStars = gameState.constellationStars.filter(s => s !== starId);
                star.classList.remove('selected');
            } else if (gameState.constellationStars.length < 3) {
                gameState.constellationStars.push(starId);
                star.classList.add('selected');
            }

            document.getElementById('constellation-status').textContent = `Ausgew√§hlt: ${gameState.constellationStars.length}/3`;
        }

        function resetConstellation() {
            gameState.constellationStars.forEach(starId => {
                const star = document.getElementById(starId);
                if (star) star.classList.remove('selected');
            });
            gameState.constellationStars = [];
            document.getElementById('constellation-status').textContent = 'Ausgew√§hlt: 0/3';
        }

        function checkConstellation() {
            const sorted = [...gameState.constellationStars].sort();
            const correct = JSON.stringify(sorted) === JSON.stringify(gameState.correctConstellation);
            
            if (correct) {
                gameState.puzzlesSolved.constellation = true;
                playSound('success');
                closePuzzle();
                showMessage(
                    '‚úÖ Konstellation gefunden!',
                    'Das Dreieck der Zeit erstrahlt am Himmel!\n\nDie drei Sterne verbinden sich mit goldenen Linien. Das Teleskop richtet sich aus und ein tiefes Brummen erf√ºllt das Observatorium.\n\nDer Weg zum innersten Heiligtum ist nun offen!',
                    () => {
                        loadScene('observatory');
                        addJournalEntry('Dreieck der Zeit', 'Die Sternkonstellation ist komplett!

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Insel der Zeit - 3D Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: #000;
            color: #fff;
            overflow: hidden;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
        }

        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        #scene-title {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            pointer-events: none;
        }

        #inventory {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 10, 0.9);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            pointer-events: all;
            display: flex;
            gap: 15px;
        }

        .inventory-item {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #666;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }

        .inventory-item.filled {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.2);
        }

        #message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 400px;
            max-width: 600px;
            background: rgba(10, 10, 30, 0.98);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 40px;
            pointer-events: all;
            display: none;
            z-index: 2000;
        }

        #message-title {
            color: #ffd700;
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
        }

        #message-text {
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
            text-align: center;
        }

        #message-btn {
            display: block;
            margin: 0 auto;
            padding: 12px 40px;
            background: #ffd700;
            color: #000;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            font-weight: bold;
        }

        #message-btn:hover {
            background: #ffed4e;
            transform: scale(1.05);
        }

        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            color: #ffd700;
            z-index: 3000;
        }

        .hint-text {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .hint-text.show {
            opacity: 1;
        }

        #controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div id="loading">Lade Spiel...</div>
    
    <div id="canvas-container"></div>

    <div id="ui-overlay">
        <div id="scene-title">üèñÔ∏è Mysteri√∂ser Strand</div>
        
        <div id="controls">
            üñ±Ô∏è Rechte Maustaste + Ziehen: Umsehen<br>
            üñ±Ô∏è Mausrad: Zoom<br>
            üñ±Ô∏è Linke Maustaste: Interagieren
        </div>

        <div id="inventory">
            <div class="inventory-item" id="slot0"></div>
            <div class="inventory-item" id="slot1"></div>
            <div class="inventory-item" id="slot2"></div>
        </div>
    </div>

    <div class="hint-text" id="hint"></div>

    <div id="message-box">
        <h3 id="message-title"></h3>
        <p id="message-text"></p>
        <button id="message-btn">Weiter</button>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Game State
        const gameState = {
            inventory: [],
            foundKey: false,
            puzzleSolved: false
        };

        // Three.js Setup
        let scene, camera, renderer, controls;
        let raycaster, mouse;
        let clickableObjects = [];

        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB);
            scene.fog = new THREE.Fog(0x87CEEB, 50, 200);

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 2, 8);

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Controls
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.maxPolarAngle = Math.PI / 2;
            controls.minDistance = 3;
            controls.maxDistance = 20;

            // Raycaster
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();

            // Lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const sunLight = new THREE.DirectionalLight(0xffffff, 0.8);
            sunLight.position.set(10, 20, 5);
            sunLight.castShadow = true;
            scene.add(sunLight);

            // Create Scene
            createBeachScene();

            // Events
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('click', onClick);
            renderer.domElement.addEventListener('mousemove', onMouseMove);

            document.getElementById('loading').style.display = 'none';

            // Start
            showMessage(
                'üèùÔ∏è Willkommen auf der Insel der Zeit',
                'Du erwachst an einem mysteri√∂sen Strand. Vor dir erhebt sich ein uralter Tempel.\n\nFinde den Schl√ºssel und enth√ºlle das Geheimnis!',
                null
            );

            animate();
        }

        function createBeachScene() {
            clickableObjects = [];

            // Ground
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshStandardMaterial({ color: 0xF4A460 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Water
            const waterGeometry = new THREE.PlaneGeometry(100, 30);
            const waterMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x4169E1,
                transparent: true,
                opacity: 0.7
            });
            const water = new THREE.Mesh(waterGeometry, waterMaterial);
            water.rotation.x = -Math.PI / 2;
            water.position.z = -30;
            water.position.y = 0.05;
            scene.add(water);

            // Temple
            const templeGroup = new THREE.Group();
            
            const templeBase = new THREE.Mesh(
                new THREE.BoxGeometry(8, 0.5, 8),
                new THREE.MeshStandardMaterial({ color: 0x808080 })
            );
            templeBase.position.y = 0.25;
            templeGroup.add(templeBase);

            const templeWall = new THREE.Mesh(
                new THREE.BoxGeometry(7, 6, 6),
                new THREE.MeshStandardMaterial({ color: 0x696969 })
            );
            templeWall.position.y = 3.5;
            templeWall.castShadow = true;
            templeGroup.add(templeWall);

            // Temple Door
            const doorGeometry = new THREE.BoxGeometry(2, 3, 0.3);
            const doorMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const door = new THREE.Mesh(doorGeometry, doorMaterial);
            door.position.set(0, 1.5, 3.2);
            door.userData = { type: 'door', interactive: true };
            templeGroup.add(door);
            clickableObjects.push(door);

            templeGroup.position.set(0, 0, -10);
            scene.add(templeGroup);

            // Palm Trees
            for (let i = 0; i < 5; i++) {
                const palm = createPalmTree();
                palm.position.set(
                    (Math.random() - 0.5) * 30,
                    0,
                    (Math.random() - 0.5) * 20 + 5
                );
                scene.add(palm);
            }

            // Key (hidden near third palm)
            const keyGeometry = new THREE.TorusGeometry(0.3, 0.1, 16, 100);
            const keyMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xFFD700,
                emissive: 0xFFD700,
                emissiveIntensity: 0.5
            });
            const key = new THREE.Mesh(keyGeometry, keyMaterial);
            key.position.set(5, 0.5, 3);
            key.rotation.x = Math.PI / 2;
            key.userData = { type: 'key', interactive: true };
            scene.add(key);
            clickableObjects.push(key);

            // Glowing particles around key
            const particlesGeometry = new THREE.BufferGeometry();
            const particlesCount = 50;
            const positions = new Float32Array(particlesCount * 3);
            for (let i = 0; i < particlesCount * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 2;
            }
            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const particlesMaterial = new THREE.PointsMaterial({
                color: 0xFFD700,
                size: 0.05,
                transparent: true,
                opacity: 0.6
            });
            const particles = new THREE.Points(particlesGeometry, particlesMaterial);
            particles.position.copy(key.position);
            scene.add(particles);

            // Sign
            const signPost = new THREE.Mesh(
                new THREE.CylinderGeometry(0.1, 0.1, 2),
                new THREE.MeshStandardMaterial({ color: 0x8B4513 })
            );
            signPost.position.set(-5, 1, 2);
            scene.add(signPost);

            const signBoard = new THREE.Mesh(
                new THREE.BoxGeometry(1.5, 1, 0.1),
                new THREE.MeshStandardMaterial({ color: 0xD2691E })
            );
            signBoard.position.set(-5, 2.5, 2);
            signBoard.userData = { type: 'sign', interactive: true };
            scene.add(signBoard);
            clickableObjects.push(signBoard);
        }

        function createPalmTree() {
            const group = new THREE.Group();

            // Trunk
            const trunkGeometry = new THREE.CylinderGeometry(0.2, 0.3, 4, 8);
            const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            trunk.position.y = 2;
            trunk.castShadow = true;
            group.add(trunk);

            // Leaves
            for (let i = 0; i < 6; i++) {
                const leafGeometry = new THREE.ConeGeometry(0.5, 2, 4);
                const leafMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22 });
                const leaf = new THREE.Mesh(leafGeometry, leafMaterial);
                leaf.position.y = 4;
                leaf.rotation.z = (i / 6) * Math.PI * 2;
                leaf.rotation.x = Math.PI / 3;
                group.add(leaf);
            }

            return group;
        }

        function onClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clickableObjects);

            if (intersects.length > 0) {
                const object = intersects[0].object;
                handleInteraction(object.userData.type);
            }
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(clickableObjects);

            const hint = document.getElementById('hint');
            if (intersects.length > 0) {
                const type = intersects[0].object.userData.type;
                let text = '';
                
                if (type === 'key' && !gameState.foundKey) text = '‚ú® Goldener Schl√ºssel';
                else if (type === 'door') text = 'üö™ Tempelt√ºr';
                else if (type === 'sign') text = 'üìú Schild lesen';

                hint.textContent = text;
                hint.classList.add('show');
                renderer.domElement.style.cursor = 'pointer';
            } else {
                hint.classList.remove('show');
                renderer.domElement.style.cursor = 'default';
            }
        }

        function handleInteraction(type) {
            if (type === 'key' && !gameState.foundKey) {
                gameState.foundKey = true;
                gameState.inventory.push('üîë');
                updateInventory();
                
                // Remove key from scene
                const keyObj = clickableObjects.find(obj => obj.userData.type === 'key');
                scene.remove(keyObj);
                clickableObjects = clickableObjects.filter(obj => obj !== keyObj);

                showMessage(
                    'üîë Schl√ºssel gefunden!',
                    'Du hast den goldenen Zeitschl√ºssel gefunden!\n\nEr pulsiert mit mystischer Energie. Vielleicht √∂ffnet er den Tempel?',
                    null
                );
            } else if (type === 'door') {
                if (gameState.foundKey) {
                    showMessage(
                        'üéâ Tempel ge√∂ffnet!',
                        'Der Schl√ºssel passt perfekt!\n\nDie T√ºr √∂ffnet sich... Ein goldenes Licht str√∂mt heraus!\n\n‚ú® Du hast das Geheimnis der Insel gel√ºftet!',
                        () => {
                            gameState.puzzleSolved = true;
                            document.getElementById('scene-title').textContent = 'üèÜ Sieg!';
                        }
                    );
                } else {
                    showMessage(
                        'üîí Verschlossen',
                        'Die T√ºr ist fest verschlossen.\n\nDu ben√∂tigst einen Schl√ºssel...',
                        null
                    );
                }
            } else if (type === 'sign') {
                showMessage(
                    'üìú Altes Schild',
                    '"Der Schl√ºssel der Zeit liegt verborgen,\nwo der Schatten der dritten Palme den Boden ber√ºhrt..."',
                    null
                );
            }
        }

        function updateInventory() {
            gameState.inventory.forEach((item, index) => {
                const slot = document.getElementById(`slot${index}`);
                slot.textContent = item;
                slot.classList.add('filled');
            });
        }

        function showMessage(title, text, callback) {
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-text').textContent = text;
            document.getElementById('message-box').style.display = 'block';

            document.getElementById('message-btn').onclick = () => {
                document.getElementById('message-box').style.display = 'none';
                if (callback) callback();
            };
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Start Game
        init();
    </script>
</body>
</html>
